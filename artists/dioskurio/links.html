<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dioskurio ‚Ä¢ Links</title>
  <meta name="robots" content="noindex,nofollow" />
  <style>
    :root { --bg:#0b0b0b; --card:#131313; --border:#1e1e1e; --fg:#f6f6f6; --muted:#b7b7b7; }
    * { box-sizing: border-box; }
    html,body { margin:0; background:var(--bg); color:var(--fg); font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif; }
    .wrap { min-height:100svh; display:grid; place-items:center; padding:18px; }
    .card { width:100%; max-width:560px; background:var(--card); border:1px solid var(--border);
            border-radius:22px; overflow:hidden; box-shadow:0 10px 30px rgba(0,0,0,.35); }
    .hero { width:100%; aspect-ratio:1/1; background:#000 center/cover no-repeat; }
    .content { padding:18px; }
    h1 { margin:6px 0 2px; font-size:22px; letter-spacing:.2px; }
    .sub { margin:0 0 10px; color:var(--muted); font-size:14px; }
    .status { margin:8px 0 14px; color:var(--muted); font-size:13px; }
    .btns { display:grid; gap:10px; grid-template-columns:1fr; }
    .btn {
      appearance: none;
      border: 0;
      border-radius: 16px;
      height: 64px; /* taller buttons */
      font-weight: 800;
      color: #fff;
      cursor: pointer;
      width: 100%;
      font-size: clamp(18px, 3vw, 22px); /* bigger text */
      letter-spacing: 0.4px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 14px; /* more spacing between icon and text */
      transition: transform 0.1s ease, filter 0.2s ease;
    }
    .btn:active {
      transform: scale(0.97);
      filter: brightness(0.9);
    }
    .btn span.icon {
      font-size: clamp(28px, 4vw, 36px);
      line-height: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .btn.ig img {
      width: clamp(38px, 5vw, 46px);
      height: auto;
    }
    .sp   { background:linear-gradient(180deg,#1db954,#0f7e31); }
    .yt   { background:linear-gradient(180deg,#ff0000,#b00000); }
    .sc   { background:linear-gradient(180deg,#ff6a2f,#d24a10); }
    .am   { background:linear-gradient(180deg,#fc3c44,#c21e24); }
    .ig   { background:linear-gradient(90deg,#f09433,#e6683c,#dc2743,#cc2366,#bc1888); }
    .small { font-size:12px; color:var(--muted); text-align:center; margin-top:10px; }
    @media (min-width:520px){ .btn { height:54px; } }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <!-- Upload your artwork next to this file as poster.png OR change the URL below -->
      <div class="hero" id="hero" style="background-image:url('poster.png');"></div>

      <div class="content">
        <h1>Sorrow Inside Sun Outside</h1>
        <p class="sub">DIOSKURIO</p>
        <br>
        <p class="status" id="status">Choose where to listen ‚Üì</p>

        <div class="btns">
          <button class="btn sp" id="btnSpotify">
            <span class="icon">üéß</span>
            Open in Spotify
          </button>
          <button class="btn yt" id="btnYouTube">
            <span class="icon">
              <!-- YouTube SVG -->
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" width="34" height="34" fill="white">
                <path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.423 64 288 64 288 64S117.578 64 74.629 75.486c-23.497 6.321-42.003 24.947-48.284 48.597-11.523 43.304-11.523 133.72-11.523 133.72s0 90.416 11.523 133.72c6.281 23.65 24.787 42.276 48.284 48.597C117.578 448 288 448 288 448s170.423 0 213.371-11.486c23.497-6.321 42.003-24.947 48.284-48.597 11.523-43.304 11.523-133.72 11.523-133.72s0-90.416-11.523-133.72zM232 336V176l142.857 80L232 336z"/>
              </svg>
            </span>
            Watch on YouTube
          </button>
          <button class="btn sc" id="btnSoundCloud">
            <span class="icon">‚òÅÔ∏è</span>
            Listen on SoundCloud
          </button>
          <button class="btn am" id="btnApple">
            <span class="icon">Ô£ø</span>
            Listen on Apple Music
          </button>
          <button class="btn ig" id="btnInstagram">
            <span class="icon">
              <img src="icons/instagram.svg" alt="Instagram" />
            </span>
            Follow on Instagram
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
(function () {
  // ====== ENV / DETECT ======
  const ua = navigator.userAgent;
  const isIOS        = /iPhone|iPad|iPod/i.test(ua);
  const isAndroid    = /Android/i.test(ua);
  const mobile       = isIOS || isAndroid;

  const isChrome     = /Chrome\/\d+/i.test(ua);
  const isIOSChrome  = /CriOS/i.test(ua);           // Chrome on iOS
  const isInApp      = /(Instagram|FBAN|FBAV|FB_IAB|Line|Twitter|TikTok|Snapchat|Pinterest)/i.test(ua);

  // ====== UI (optional) ======
  const statusEl = document.getElementById('status');
  const setStatus = (m)=>{ if(statusEl) statusEl.textContent = m; };
  const resetToIdle = ()=> setStatus('Choose where to listen ‚Üì');

  // ====== LINKS ======
  const LINKS = {
    spotify: {
      name:'spotify',
      app:'spotify:track:3DkqD9nNLmhkZI0nlqa7L6',
      web:'https://open.spotify.com/track/3DkqD9nNLmhkZI0nlqa7L6',
      // Android Chrome intent with browser fallback (prevents Play Store jump)
      intent:'intent://open.spotify.com/track/3DkqD9nNLmhkZI0nlqa7L6#Intent;scheme=https;package=com.spotify.music;S.browser_fallback_url=https%3A%2F%2Fopen.spotify.com%2Ftrack%2F3DkqD9nNLmhkZI0nlqa7L6;end',
      tryAppOnMobile:true,  tryAppOnDesktop:true,  fallbackMs:1500
    },
    youtube: {
      name:'youtube',
      app:'youtube://www.youtube.com/watch?v=nuSvp2BF-ps',
      web:'https://www.youtube.com/watch?v=nuSvp2BF-ps',
      intent:'intent://www.youtube.com/watch?v=nuSvp2BF-ps#Intent;scheme=https;package=com.google.android.youtube;S.browser_fallback_url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DnuSvp2BF-ps;end',
      tryAppOnMobile:true,  tryAppOnDesktop:false, fallbackMs:700
    },
    soundcloud: {
      name:'soundcloud',
      app:null,
      web:'https://soundcloud.com/dioskurio/sorrow-inside-sun-outside',
      tryAppOnMobile:false, tryAppOnDesktop:false, fallbackMs:0
    },
    applemusic: {
      name:'applemusic',
      app:null,
      web:'https://music.apple.com/us/album/1846007392?i=1846007393',
      tryAppOnMobile:false, tryAppOnDesktop:false, fallbackMs:0
    },
    instagram: {
      name:'instagram',
      app:'instagram://user?username=dioskurio',
      web:'https://www.instagram.com/dioskurio',
      intent:'intent://instagram.com/_u/dioskurio#Intent;scheme=https;package=com.instagram.android;S.browser_fallback_url=https%3A%2F%2Fwww.instagram.com%2Fdioskurio;end',
      tryAppOnMobile:true,  tryAppOnDesktop:false, fallbackMs:600
    }
  };

  // ====== LOGGING (as before) ======
  const LOG_URL = 'log.php';
  function log(event, dest, extra) {
    const qp = new URLSearchParams(location.search);
    let src = '';

    // Ads (instagram/facebook/messenger). configure ads with utm_source={{site_source_name}}
    if (qp.has('utm_source')) {
      src = qp.get('utm_source').toLowerCase();
    }
    // Bio links: use origin=ig_bio / fb_bio
    else if (qp.has('origin')) {
      src = qp.get('origin');
    }
    // Organic posts: plain links with fbclid (added by Meta)
    else if (qp.has('fbclid')) {
      src = 'fbclid';
    }
    // Everything else: empty string
    else {
      src = '';
    }

    // === FINAL PAYLOAD ===
    const payload = Object.assign({
      time: new Date().toISOString(),
      event,
      dest,
      src,   // exactly matches your mapping
    }, extra || {});

    const data = JSON.stringify(payload);

    // === SEND LOG ===
    if (navigator.sendBeacon) {
      navigator.sendBeacon(LOG_URL, data);
    } else {
      fetch(LOG_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: data,
        keepalive: true
      }).catch(() => {});
    }
  }

  log('view','page');

  // ====== CORE OPEN (click only) ======
  function openTarget(key){
    const t = LINKS[key]; if(!t) return;
    setStatus(`Opening ${t.name.charAt(0).toUpperCase()+t.name.slice(1)}‚Ä¶`);

    // Decide whether to try app first
    let tryApp = (mobile ? t.tryAppOnMobile : t.tryAppOnDesktop) && t.app;
    const appUrl = t.app, webUrl = t.web;

    // a) iOS legacy (<=12) OR iOS in-app (Instagram/FB etc.) ‚Üí avoid schemes
    if (isIOS && (t.name==='spotify' || t.name==='instagram' || t.name==='youtube' || t.name==='applemusic')) {
      tryApp = false; // use https directly to avoid "address invalid" or blocked schemes
    }

    let fallbackTimer = null;
    let appLikelyOpened = false;

    const OPEN_FLAG = `dw_opened_${t.name}`;

    function cancelFallback(){ if(fallbackTimer){ clearTimeout(fallbackTimer); fallbackTimer=null; } }
    function markOpened(){
      appLikelyOpened = true;
      try { sessionStorage.setItem(OPEN_FLAG, '1'); } catch {}
      cancelFallback();
      resetToIdle();
      detachListeners();
    }
    function detachListeners(){
      window.removeEventListener('visibilitychange', onVis);
      window.removeEventListener('blur', onBlur);
      window.removeEventListener('pagehide', onBlur);
      window.removeEventListener('beforeunload', onBlur);
    }
    function onVis(){ if(document.visibilityState === 'hidden') markOpened(); }
    function onBlur(){ markOpened(); }

    window.addEventListener('visibilitychange', onVis, {once:true});
    window.addEventListener('blur', onBlur, {once:true});
    window.addEventListener('pagehide', onBlur, {once:true});
    window.addEventListener('beforeunload', onBlur, {once:true});

    log('click', tryApp ? `${t.name}_app` : `${t.name}_web`, { target:t.name });

    // === ANDROID ===
    if (isAndroid && tryApp) {
      if (isChrome && !isInApp && t.intent) {
        // Chrome ‚Üí use intent:// with browser_fallback_url (no Play Store bounce)
        location.href = t.intent;
        return; // do not add our own timer here
      } else {
        // In-app browsers on Android ‚Üí https (App Links may still open app)
        location.href = webUrl;
        return;
      }
    }

    // === iOS (Safari = good with fallback; Chrome on iOS = no auto-fallback) ===
    if (isIOS && tryApp) {
      location.href = appUrl;

      if (isIOSChrome) {
        // Chrome on iOS: DON'T auto-fallback to web (prevents parallel redirect)
        const ms = t.fallbackMs || 1500;
        setTimeout(() => {
          if (!appLikelyOpened && document.visibilityState === 'visible') {
            setStatus(`If nothing opened, tap the ${t.name} button again to use the web version.`);
          }
        }, ms);
        return;
      } else {
        // Safari on iOS: allow timed fallback to web if still visible
        if (webUrl && t.fallbackMs > 0){
          fallbackTimer = setTimeout(() => {
            if (!appLikelyOpened && document.visibilityState === 'visible') {
              log('fallback', `${t.name}_web`);
              location.href = webUrl;
            }
          }, t.fallbackMs);
        }
        return;
      }
    }

    // === DESKTOP or when not trying app ===
    if (tryApp) {
      // Desktop app schemes are hit-or-miss; keep your previous behavior
      location.href = appUrl;
      if (webUrl && t.fallbackMs > 0){
        fallbackTimer = setTimeout(() => {
          if (!appLikelyOpened && document.visibilityState === 'visible') {
            log('fallback', `${t.name}_web`);
            location.href = webUrl;
          }
        }, t.fallbackMs);
      }
    } else {
      location.href = webUrl;
    }
  }

  // Return-to-page idle
  window.addEventListener('focus', () => {
    for (const k in LINKS){
      try {
        if (sessionStorage.getItem(`dw_opened_${LINKS[k].name}`) === '1') {
          resetToIdle();
          break;
        }
      } catch {}
    }
  });

  // Wire buttons
  document.getElementById('btnSpotify')   ?.addEventListener('click', () => openTarget('spotify'));
  document.getElementById('btnYouTube')   ?.addEventListener('click', () => openTarget('youtube'));
  document.getElementById('btnSoundCloud')?.addEventListener('click', () => openTarget('soundcloud'));
  document.getElementById('btnApple')     ?.addEventListener('click', () => openTarget('applemusic'));
  document.getElementById('btnInstagram') ?.addEventListener('click', () => openTarget('instagram'));
})();
</script>
</body>
</html>